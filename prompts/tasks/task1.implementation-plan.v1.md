# å®Ÿè£…è¨ˆç”» - search-docsåˆæœŸå®Ÿè£…

> **ğŸ”’ ã“ã®æ–‡ç« ã¯FIXEDã§ã™ (2025-11-04)**
> ä»¥é™ã®ä¿®æ­£ã¯æ³¨é‡ˆè¿½è¨˜ã®ã¿è¨±å¯ã•ã‚Œã¾ã™

## ä½œæ¥­æ—¥
2025-01-27

## ç›®çš„
search-docsã®åŸºæœ¬å®Ÿè£…ã‚’å®Œäº†ã•ã›ã€å‹•ä½œå¯èƒ½ãªçŠ¶æ…‹ã«ã™ã‚‹

## ä½œæ¥­æ–¹é‡

### æ³¨æ„äº‹é …
1. âœ… ä½œæ¥­å‰ã«ä½œæ¥­è¨ˆç”»ã‚’ç«‹ã¦ã‚‹
2. âœ… ä½œæ¥­é€²æ—ã‚’ãƒ¡ãƒ¢ã§ç®¡ç†ã™ã‚‹
3. âœ… ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆåœ§ç¸®å¾Œã¯é–¢é€£æ–‡æ›¸ã‚’å®Œå…¨ã«å†èª­ã¿è¾¼ã¿

### å‚ç…§ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- @../AGENTS.md
- @../../docs/client-server-architecture.md
- @../../docs/data-model.md
- @../../docs/architecture.md

## å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚º

### Phase 1: åŸºç›¤ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã€å„ªå…ˆåº¦: é«˜ã€‘

#### 1.1 å…±é€šå‹å®šç¾© (packages/types)
- [x] ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹å®šç¾©
  - Document, Section, SearchResult
  - SearchDocsConfig
  - API Request/Responseå‹
- [x] å‹ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
- [x] package.jsonè¨­å®š
- [x] ãƒ“ãƒ«ãƒ‰ç¢ºèª

**æˆæœç‰©**: `@search-docs/types` âœ… **å®Œäº†**

**å®Ÿè£…å†…å®¹**:
- document.ts: Document, DocumentMetadata
- section.ts: Section, SectionMetadata
- config.ts: SearchDocsConfig, DEFAULT_CONFIG
- api.ts: API Request/Response, JSON-RPC types
- storage.ts: DocumentStorageã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹
- index.ts: ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

#### 1.2 DocumentStorage (packages/storage)
- [x] DocumentStorageã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹å®Ÿè£…
- [x] ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å®Ÿè£…
  - JSONå½¢å¼ã§ä¿å­˜
  - ãƒ‘ã‚¹æ­£è¦åŒ–
  - CRUDæ“ä½œ
  - ãƒãƒƒã‚·ãƒ¥è¨ˆç®—
- [x] ãƒ†ã‚¹ãƒˆä½œæˆï¼ˆ15ãƒ†ã‚¹ãƒˆã€å…¨ã¦é€šéï¼‰

**æˆæœç‰©**: `@search-docs/storage` âœ… **å®Œäº†**

**å®Ÿè£…å†…å®¹**:
- FileStorageã‚¯ãƒ©ã‚¹
  - save/get/delete/list/exists
  - ãƒ‘ã‚¹æ­£è¦åŒ–ï¼ˆWindows/Unixäº’æ›ï¼‰
  - SHA-256ãƒãƒƒã‚·ãƒ¥è¨ˆç®—
- ãƒ†ã‚¹ãƒˆ: file-storage.test.tsï¼ˆ15ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ï¼‰
  - CRUDæ“ä½œ
  - ãƒ‘ã‚¹æ­£è¦åŒ–
  - ãƒãƒƒã‚·ãƒ¥è¨ˆç®—
  - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

#### 1.3 DB Engine (packages/db-engine)
- [x] Pythonã‚¹ã‚­ãƒ¼ãƒå®šç¾© (schemas.py)
- [x] åŸ‹ã‚è¾¼ã¿ãƒ¢ãƒ‡ãƒ«çµ±åˆ (embedding.py)
- [x] LanceDBãƒ¯ãƒ¼ã‚«ãƒ¼ (worker.py)
- [x] TypeScriptãƒ©ãƒƒãƒ‘ãƒ¼
- [x] ãƒ†ã‚¹ãƒˆä½œæˆ
- [x] Pythonç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— (uv sync)

**æˆæœç‰©**: `@search-docs/db-engine` âœ… **å®Œäº†**

**å‚è€ƒ**: `../sebas-chan/packages/db/src/python/`

**å®Ÿè£…å†…å®¹**:
- Pythonå®Ÿè£…:
  - schemas.py: PyArrowã‚¹ã‚­ãƒ¼ãƒå®šç¾©
  - embedding.py: RuriåŸ‹ã‚è¾¼ã¿ãƒ¢ãƒ‡ãƒ« (256d/768d)
  - worker.py: LanceDB JSON-RPCãƒ¯ãƒ¼ã‚«ãƒ¼
- TypeScriptå®Ÿè£…:
  - index.ts: DBEngineã‚¯ãƒ©ã‚¹ (JSON-RPCé€šä¿¡)
- ãƒ†ã‚¹ãƒˆ: db-engine.test.ts (æ¥ç¶šã€CRUDã€æ¤œç´¢ã€Dirtyç®¡ç†)

### Phase 2: ã‚µãƒ¼ãƒå®Ÿè£…ã€å„ªå…ˆåº¦: é«˜ã€‘

#### 2.1 è¨­å®šç®¡ç† (packages/server)
- [ ] è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãƒ­ãƒ¼ãƒ€ãƒ¼
- [ ] ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®š
- [ ] ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- [ ] ãƒ†ã‚¹ãƒˆä½œæˆ

#### 2.2 ãƒ•ã‚¡ã‚¤ãƒ«æ¤œç´¢
- [ ] Globãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°
- [ ] .gitignoreè§£æ
- [ ] ãƒ•ã‚¡ã‚¤ãƒ«ã‚¦ã‚©ãƒƒãƒãƒ£ãƒ¼çµ±åˆ
- [ ] ãƒ†ã‚¹ãƒˆä½œæˆ

#### 2.3 Markdownåˆ†å‰²
- [ ] Markdownãƒ‘ãƒ¼ã‚µãƒ¼
- [ ] ãƒˆãƒ¼ã‚¯ãƒ³è¨ˆæ¸¬ (tiktoken)
- [ ] å†å¸°çš„åˆ†å‰²ãƒ­ã‚¸ãƒƒã‚¯
- [ ] ãƒ†ã‚¹ãƒˆä½œæˆ

#### 2.4 ã‚µãƒ¼ãƒã‚³ã‚¢
- [ ] JSON-RPCã‚µãƒ¼ãƒå®Ÿè£…
- [ ] APIãƒãƒ³ãƒ‰ãƒ©
  - search
  - getDocument
  - indexDocument
  - getStatus
  - rebuildIndex
- [ ] Dirtyãƒ¯ãƒ¼ã‚«ãƒ¼
- [ ] ãƒ†ã‚¹ãƒˆä½œæˆ

**æˆæœç‰©**: `@search-docs/server`

### Phase 3: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå®Ÿè£…ã€å„ªå…ˆåº¦: ä¸­ã€‘

#### 3.1 ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒª (packages/client)
- [ ] SearchDocsClientã‚¯ãƒ©ã‚¹
- [ ] JSON-RPCé€šä¿¡
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- [ ] ãƒ†ã‚¹ãƒˆä½œæˆ

**æˆæœç‰©**: `@search-docs/client`

#### 3.2 CLIãƒ„ãƒ¼ãƒ« (packages/cli)
- [ ] ã‚³ãƒãƒ³ãƒ‰å®Ÿè£…
  - server (start/stop/status)
  - search
  - index (rebuild/status/clean-dirty)
  - config (init/validate/show)
- [ ] å¼•æ•°ãƒ‘ãƒ¼ã‚¹
- [ ] å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
- [ ] ãƒ†ã‚¹ãƒˆä½œæˆ

**æˆæœç‰©**: `@search-docs/cli`

### Phase 4: Claude Codeçµ±åˆã€å„ªå…ˆåº¦: ä¸­ã€‘

#### 4.1 MCP Server (packages/mcp-server)
- [ ] MCPãƒ—ãƒ­ãƒˆã‚³ãƒ«å®Ÿè£…
- [ ] ãƒ„ãƒ¼ãƒ«å®šç¾©
  - search
  - getDocument
- [ ] ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªçµ±åˆ
- [ ] ãƒ†ã‚¹ãƒˆä½œæˆ

**æˆæœç‰©**: `@search-docs/mcp-server`

## å®Ÿè£…é †åº

```
1. types â†’ storage â†’ db-engine (ä¸¦è¡Œå¯èƒ½)
2. server (config â†’ discovery â†’ parser â†’ core)
3. client
4. cli
5. mcp-server
```

## å„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ä¾å­˜é–¢ä¿‚

```
types (å…±é€šå‹)
  â†“
storage, db-engine (ä¸¦è¡Œ)
  â†“
server
  â†“
client
  â†“
cli, mcp-server (ä¸¦è¡Œ)
```

## ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³

### M1: åŸºç›¤å®Œæˆ
- types, storage, db-engineå®Œæˆ
- å˜ä½“ãƒ†ã‚¹ãƒˆå®Œäº†

### M2: ã‚µãƒ¼ãƒå‹•ä½œ
- serverå®Ÿè£…å®Œäº†
- åŸºæœ¬çš„ãªæ¤œç´¢ãŒå‹•ä½œ
- çµ±åˆãƒ†ã‚¹ãƒˆå®Œäº†

### M3: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå®Œæˆ
- client, cliå®Ÿè£…å®Œäº†
- E2Eãƒ†ã‚¹ãƒˆå®Œäº†

### M4: Claude Codeçµ±åˆ
- mcp-serverå®Ÿè£…å®Œäº†
- å®Ÿéš›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã®å‹•ä½œç¢ºèª

## å„ãƒ•ã‚§ãƒ¼ã‚ºã§ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°

- [ ] README.mdã®æ›´æ–°ï¼ˆä½¿ç”¨æ–¹æ³•ã®å…·ä½“åŒ–ï¼‰
- [ ] docs/é…ä¸‹ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°
- [ ] å„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®READMEä½œæˆ

## ãƒªã‚¹ã‚¯ç®¡ç†

### æŠ€è¡“çš„ãƒªã‚¹ã‚¯
1. **LanceDBçµ±åˆ**: sebas-chanã®å®Ÿè£…ã‚’å‚è€ƒã«é€²ã‚ã‚‹
2. **ãƒˆãƒ¼ã‚¯ãƒ³è¨ˆæ¸¬**: tiktokenã®é©åˆ‡ãªçµ±åˆ
3. **JSON-RPC**: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®é©åˆ‡ãªå®Ÿè£…

### å¯¾å¿œç­–
- å„ãƒ•ã‚§ãƒ¼ã‚ºã§ãƒ†ã‚¹ãƒˆã‚’å¿…ãšä½œæˆ
- å°ã•ãå®Ÿè£…ã—ã¦å‹•ä½œç¢ºèª
- sebas-chanã®ã‚³ãƒ¼ãƒ‰ã‚’å‚ç…§

## æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

1. âœ… ä½œæ¥­è¨ˆç”»ã®ä½œæˆ
2. ğŸ”² packages/types ã®ä½œæˆé–‹å§‹
3. ğŸ”² é€²æ—ã‚’ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§ç®¡ç†

---

**ä½œæˆæ—¥**: 2025-01-27
**æœ€çµ‚æ›´æ–°**: 2025-01-27
**çŠ¶æ…‹**: ä½œæˆå®Œäº†ã€å®Ÿè£…é–‹å§‹å¾…ã¡
